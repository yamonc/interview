# 数据库基本知识

## 为什么使用数据库？

方便保存和查看。我们可以将数据保存在内存、保存在文件、保存在数据库中。

优缺点如下：

|        | 优点                                                  | 缺点                                     |
| ------ | ----------------------------------------------------- | ---------------------------------------- |
| 内存   | 存取速度快                                            | 数据不能永久保存                         |
| 文件   | 数据永久保存                                          | 速度比内存操作慢，频繁IO、查询数据不方便 |
| 数据库 | 数据永久保存、使用SQL语言，查询效率高、管理数据方便。 |                                          |

## 什么是SQL？

结构化查询语言(Structured Query Language)简称SQL，是一种数据库查询语言。

作用：用于存取数据、查询、更新和管理关系数据库系统。

## 什么是MySQL？

MySQL是一个关系型数据库管理系统，由瑞典MySQL AB 公司开发，属于 Oracle 旗下产品。MySQL 是最流行的关系型数据库管理系统之一，在 WEB 应用方面，MySQL是最好的 RDBMS (Relational Database Management System，关系数据库管理系统) 应用软件之一。在Java企业级开发中非常常用，因为 MySQL 是开源免费的，并且方便扩展。


## 数据库的三大范式？

第一范式：数据库表中的数据都是不可再分的原子值。

第二范式：在第一范式的基础上，数据库表中的非主键属性都完全依赖主键属性。但是不能成为依赖于主键的一部分。

第三范式：在第二范式的基础上，数据库表中的非主键属性对任何候选关键字不存在传递依赖。

## MySQL的权限表有哪些？

MySQL服务器通过权限表来控制用户对数据库的访问，权限表放在MySQL数据库里，由mysql_install_db脚本初始化。这些权限表分别为：user,db,table_priv,columns_priv和host：

- user权限表：记录允许连接到服务器的用户账户信息，里面的权限都是全局级的。
- db权限表：记录各个账号在各个数据库上的操作权限
- table_priv权限表:记录数据表级的操作权限
- columns_priv权限表：记录数据行级的操作权限
- host权限表：配合db权限表对给定主机上数据库级操作权限更细致的控制。这个权限表不受Grant和revoke语句影响。

## MySQL的binlog有几种录入方式？分别有什么区别？

binlog数据库级别的log，关注恢复数据库的数据。

### 引申1：数据库的其他几种日志?

> redo log:存储引擎级别的日志，InnoDB有。该log关注事务的恢复，在重启MySQL服务的时候，根据redo log重做，从而使事务有持久性。
>
> undo log：存储引擎级别的日志，InnoDB有，该log关注事务的回滚，保证数据的原子性，该log保存了事务发生之前的数据的一个版本，可以用于回滚，是MVCC的重要实现方法之一。

### 引申：事务的四大特性？

> 事务的四大特性：
>
> ACID：原子性、一致性、持久性和隔离性。
>
> 1. 其中原子性：一个事务要么所有的操作都完成，要不全部不完成。（undo log保证原子性）
> 2. 一致性：事务执行前后数据库的状态保持一致。(锁机制？)
> 3. 持久性：事务执行完毕之后，对数据的修改是永久的，即使系统故障也不会发生丢失（redo log保证持久性）
> 4. 隔离性：多个并发事务对数据库操作，事务之间不会发生干扰。（MVCC保证隔离性）

binlog的三种格式：statement、row和mixed

- statment模式：每一条会修改数据的sql会记录在binlog中。不需要记录每一行的变化，减少了binlog日志量，节约了IO，提高性能。由于sql的执行是有上下文的，因此在保存的时候需要保存相关信息，同时还有一些使用了函数之类的语句无法被记录复制。
- row模式：不记录sql语句上下文相关信息，仅仅保存那条记录被修改。记录单元为每一行的改动，基本是可以全部记录下来但是由于很多操作，会导致大量的改动（比如alter table），因此这类模式文件保存的信息比较多，日志量太大。
- mixed模式：一种折中的方案，普通操作使用statement模式，当无法使用statement的时候使用row。

此外，新版的MySQL中对row级别也做了一些优化，当表结构发生变化的时候，会记录语句而不是逐行记录。

## 数据类型

### MySQL有哪些数据类型？



| **分类**             | **类型名称** | **说明**                                                     |
| -------------------- | ------------ | ------------------------------------------------------------ |
| **整数类型**         | tinyInt      | 很小的整数(8位二进制)                                        |
|                      | smallint     | 小的整数(16位二进制)                                         |
|                      | mediumint    | 中等大小的整数(24位二进制)                                   |
|                      | int(integer) | 普通大小的整数(32位二进制)                                   |
| **小数类型**         | float        | 单精度浮点数                                                 |
|                      | double       | 双精度浮点数                                                 |
|                      | decimal(m,d) | 压缩严格的定点数                                             |
| **日期类型**         | year         | YYYY 1901~2155                                               |
|                      | time         | HH:MM:SS -838:59:59~838:59:59                                |
|                      | date         | YYYY-MM-DD 1000-01-01~9999-12-3                              |
|                      | datetime     | YYYY-MM-DD HH:MM:SS 1000-01-01 00:00:00~ 9999-12-31 23:59:59 |
|                      | timestamp    | YYYY-MM-DD HH:MM:SS 19700101 00:00:01 UTC~2038-01-19 03:14:07UTC |
| **文本、二进制类型** | CHAR(M)      | M为0~255之间的整数                                           |
|                      | VARCHAR(M)   | M为0~65535之间的整数                                         |
|                      | TINYBLOB     | 允许长度0~255字节                                            |
|                      | BLOB         | 允许长度0~65535字节                                          |
|                      | MEDIUMBLOB   | 允许长度0~167772150字节                                      |
|                      | LONGBLOB     | 允许长度0~4294967295字节                                     |
|                      | TINYTEXT     | 允许长度0~255字节                                            |
|                      | LONGTEXT     | 允许长度0~4294967295字节                                     |
|                      | VARBINARY(M) | 允许长度0~M个字节的变长字节字符串                            |
|                      | BINARY(M)    | 允许长度0~M个字节的定长字节字符串                            |

1、整数类型，包括TINYINT、SMALLINT、MEDIUMINT、INT、BIGINT，分别表示1字节、2字节、3字节、4字节、8字节整数。任何整数类型都可以加上UNSIGNED属性，表示数据是无符号的，即非负整数。
长度：整数类型可以被指定长度，例如：INT(11)表示长度为11的INT类型。长度在大多数场景是没有意义的，它不会限制值的合法范围，只会影响显示字符的个数，而且需要和UNSIGNED ZEROFILL属性配合使用才有意义。
例子，假定类型设定为INT(5)，属性为UNSIGNED ZEROFILL，如果用户插入的数据为12的话，那么数据库实际存储数据为00012。

2、实数类型，包括FLOAT、DOUBLE、DECIMAL。
DECIMAL可以用于存储比BIGINT还大的整型，能存储精确的小数。
而FLOAT和DOUBLE是有取值范围的，并支持使用标准的浮点进行近似计算。
计算时FLOAT和DOUBLE相比DECIMAL效率更高一些，DECIMAL你可以理解成是用字符串进行处理。

3、字符串类型，包括VARCHAR、CHAR、TEXT、BLOB
VARCHAR用于存储可变长字符串，它比定长类型更节省空间。
VARCHAR使用额外1或2个字节存储字符串长度。列长度小于255字节时，使用1字节表示，否则使用2字节表示。
VARCHAR存储的内容超出设置的长度时，内容会被截断。
CHAR是定长的，根据定义的字符串长度分配足够的空间。
CHAR会根据需要使用空格进行填充方便比较。
CHAR适合存储很短的字符串，或者所有值都接近同一个长度。
CHAR存储的内容超出设置的长度时，内容同样会被截断。

使用策略：
对于经常变更的数据来说，CHAR比VARCHAR更好，因为CHAR不容易产生碎片。
对于非常短的列，CHAR比VARCHAR在存储空间上更有效率。
使用时要注意只分配需要的空间，更长的列排序时会消耗更多内存。
尽量避免使用TEXT/BLOB类型，查询时会使用临时表，导致严重的性能开销。

4、枚举类型（ENUM），把不重复的数据存储为一个预定义的集合。
有时可以使用ENUM代替常用的字符串类型。
ENUM存储非常紧凑，会把列表值压缩到一个或两个字节。
ENUM在内部存储时，其实存的是整数。
尽量避免使用数字作为ENUM枚举的常量，因为容易混乱。
排序是按照内部存储的整数

5、日期和时间类型，尽量使用timestamp，空间效率高于datetime，
用整数保存时间戳通常不方便处理。
如果需要存储微妙，可以使用bigint存储。
看到这里，这道真题是不是就比较容易回答了。

## 参考

[MySQL面试题2020](https://thinkwon.blog.csdn.net/article/details/104778621)

